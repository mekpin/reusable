on:
  workflow_call:
    inputs:
      service_name:
        description: 'Name of service/web app repository'
        required: false
        type: string
      secrets:
        required: true
      runner_os: 
         required: false


env:
#  untuk default isi dengan nama repo
#  SERVICE_NAME: ${{ inputs.service_name || github.event.repository.name  }}
  SERVICE_NAME: ${{ inputs.service_name || 'ga masuk'  }}
  runner_os: ${{ 'macos'  }}



jobs:
  define:
    runs-on: ubuntu-latest
    outputs: 
      nama_runner: ${{ steps.declarerunner.outputs.value }}
    steps:
      - id: declarerunner
        run: |
          if ${{startsWith(env.runner_os, 'ubuntu')}}
          then
            echo "value=ubuntu-latest"
            echo "::notice title=runner::ubuntu-latest"
          elif ${{startsWith(env.runner_os, 'macos')}}
          then
            echo "value=macos-latest"
            echo "::notice title=runner::macos-latest"
          fi

  broadcast:
    needs: define
    runs-on: ${{ needs.define.outputs.nama_runner}}
    steps:
      - name: input to variable service_name
        id: naming 
        run: echo "name=tags::docker_hub/${{ env.SERVICE_NAME }}:${GITHUB_REF#refs/*/}" 

      - name: read variable service_name
        id: read 
        run: echo "::notice title=naming tag created::${{ steps.naming.outputs.tags }}" 
