on:
  workflow_call:
    inputs:
      service_name:
        description: 'Name of service/web app repository'
        required: false
        type: string
#      secrets:
#        required: true
 #       type: string


env:
#  untuk default isi dengan nama repo
#  SERVICE_NAME: ${{ inputs.service_name || github.event.repository.name  }}
  SERVICE_NAME: ${{ inputs.service_name || 'ga masuk'  }}
#  ssh_token: ${{ inputs.secrets || 'ga masuk'  }}
  runner_os: ${{ 'macos'  }}



jobs:
  define:
    runs-on: ubuntu-latest
    outputs: 
      nama_runner: ${{ steps.declarerunner.outputs.value }}
    steps:
      - id: declarerunner
        run: |
          if ${{startsWith(env.runner_os, 'ubuntu')}}
          then
            echo "value=ubuntu-latest" >> $GITHUB_OUTPUT
            echo "::notice title=runner::ubuntu-latest"
          elif ${{startsWith(env.runner_os, 'macos')}}
          then
            echo "value=macos-latest" >> $GITHUB_OUTPUT
            echo "::notice title=runner::macos-latest"
          fi


  broadcast:
    needs: define
    runs-on: ubuntu-latest
    steps:
      - name: input to variable service_name
        id: naming 
        run: echo "name=tags::docker_hub/${{ env.SERVICE_NAME }}:${GITHUB_REF#refs/*/}" 

      - name: read variable service_name
        id: read_service_name
        run: echo "::notice title=naming tag created::${{ steps.naming.outputs.tags }}" 

      - name: read nama runner
        id: read_runner_name
        run: echo "${{ needs.define.outputs.nama_runner}}"


#      - name: read secret ssh_token
#        id: read_token
#        run: echo "::notice title=token token created::${{ env.ssh_token }}" 
